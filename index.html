<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!-- Landing Page 1 â€“ Audio + Share Incentive -->
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nana Sweets | LiÄna poruka</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#fff0f5 0%,#ffe4e1 100%); display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px;}
.container { background:white; border-radius:24px; box-shadow:0 20px 40px rgba(0,0,0,0.1); max-width:400px; width:100%; overflow:hidden; border:1px solid #ffd6e0; text-align:center; padding:30px;}
.header h1 { color:#ff1493; font-size:22px; margin-bottom:10px; line-height:1.3; }
.header p { font-size:14px; color:#555; margin-bottom:20px; }
.product-image {
  width: auto; /* Menja width: 100% */
  max-width: 70%; /* Ovo ga smanjuje za ~30% */
  border-radius: 12px;
  max-height: 250px;
  object-fit: contain; /* Bolje za logo - ne seÄe ga */
  margin: 0 auto 20px auto; /* Centrira logo */
  display: block;
}
.audio-player { margin-bottom:25px; }
audio { width:100%; border-radius:50px; height:45px; }
.cta-button {
  display: inline-block;
  background: linear-gradient(90deg,#ff69b4 0%,#ff1493 100%);
  color: white;
  padding: 16px 32px;
  border-radius: 50px;
  font-weight: 700;
  font-size: 16px;
  text-decoration: none;
  width: 100%;
  max-width: 300px;
  margin: 0 auto 10px;
  text-align: center;
  transition: all 0.3s ease;
}
.cta-button:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(255,105,180,0.4);
}
.note { font-size:14px; color:#555; margin-top:10px; line-height:1.4; }
.customer-name { color: #ff1493; font-weight: bold; }

/* Nove klase za priÄu i instrukcije */
.story-box {
  background: #fffafc;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 25px;
  text-align: left;
  border-left: 4px solid #ff69b4;
  box-shadow: 0 5px 15px rgba(255,105,180,0.1);
}

.story-title {
  color: #ff1493;
  font-size: 18px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.story-title i {
  font-size: 20px;
}

.story-text {
  font-size: 15px;
  line-height: 1.6;
  color: #555;
}

.story-text::first-letter {
  font-size: 24px;
  color: #ff1493;
  font-weight: bold;
  float: left;
  margin-right: 5px;
  line-height: 1;
}

.voucher-instructions {
  background: linear-gradient(135deg,#fff5f7 0%,#ffebee 100%);
  border-radius: 12px;
  padding: 18px;
  margin-top: 20px;
  text-align: left;
  border: 2px dashed #ff69b4;
}

.voucher-instructions h3 {
  color: #ff1493;
  font-size: 16px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.steps {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.step {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-size: 14px;
}

.step-number {
  background: #ff1493;
  color: white;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 12px;
  font-weight: bold;
}

.step-text {
  color: #555;
  line-height: 1.5;
}

.step-text strong {
  color: #ff1493;
}

.footer-note {
  font-size: 12px;
  color: #888;
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.visit-counter {
  font-size: 11px;
  color: #aaa;
  margin-top: 5px;
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1 id="welcome-text">PosluÅ¡aj svoju liÄnu poruku ğŸ‚</h1>
    <p>OseÄ‡aj magiju svake torte</p>
  </div>
  
  <img src="https://www.dropbox.com/scl/fi/uwly1sop6cqsrtoxakybm/Logo_Nana_Sweets-removebg-preview.png?rlkey=82llkp5ms0udukxlngeog5uur&st=yes8fyb4&raw=1" alt="Nana Sweets Torta" class="product-image" id="cake-image">
  
  <!-- PRIÄŒA PRE AUDIO PLEJERA -->
  <div class="story-box">
    <div class="story-title">
      <i class="fas fa-heart"></i>
      <span>PriÄa iza vaÅ¡e torte</span>
    </div>
    <div class="story-text" id="story-text">
      Svaka torta iz Nana Sweets radnje nosi priÄu. PriÄu o paÅ¾ljivo odabranim sastojcima, o trenucima radosti koje stvara, i o ljubavi koju ulaÅ¾emo u svaki sloj. Dok drÅ¾ite ovu kutiju, drÅ¾ite deo naÅ¡e duÅ¡e. Sada vas pozivamo da Äujete i zvuk te priÄe...
    </div>
  </div>
  
  <!-- AUDIO PLEJER -->
  <div class="audio-player">
    <audio id="audioPlayer" controls controlsList="nodownload">
      <source src="" type="audio/mpeg" id="audioSource">
      VaÅ¡ pregledaÄ ne podrÅ¾ava audio element.
    </audio>
    <p id="audio-status" style="font-size:12px; color:#888; margin-top:5px;"></p>
  </div>
  
  <!-- CTA DUGME -->
  <a href="https://nanasweets.github.io/nanasweetsaudio/share.html" class="cta-button" id="shareButton">
    <i class="fas fa-gift"></i> Podeli i osvoji vauÄer ğŸ
  </a>
  
  <!-- INSTRUKCIJE POSLE CTA DUGMETA -->
  <div class="voucher-instructions">
    <h3><i class="fas fa-trophy"></i> Kako do vauÄera od 2.000 RSD</h3>
    <div class="steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-text">PosluÅ¡aj <strong>audio poruku</strong> iznad</div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-text">Klikni na <strong>"Podeli i osvoji vauÄer"</strong></div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-text">Podeli svoje iskustvo na <strong>Instagram</strong> ili <strong>WhatsApp</strong></div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-text">PoÅ¡alji nam <strong>screenshot</strong> i dobijaÅ¡ <strong>vauÄer</strong></div>
      </div>
    </div>
  </div>
  
  <!-- FOOTER -->
  <div class="footer-note">
    ğŸ‚ Svaka torta ima svoju priÄu, a svaki kupac svoj vauÄer!
    <div class="visit-counter">
      Nana Sweets Â© 2025 | <span id="visit-counter">Poseta: 1</span>
    </div>
  </div>
</div>

<script>
// ==================== KONFIGURACIJA ====================
// ğŸ”‘ ZAMENITE OVAJ LINK SA PUBLISHED CSV LINKOM VAÅ EG GOOGLE SHEETS-A
const GOOGLE_SHEETS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTjIXnMLrz-Lp2Fl1l60T0h_tawFOSbwNbQD9k6fj78UKNA3Vtuzvgy7MSIPeolmMMqwPLjh7S0KsTH/pub?output=csv';

// ==================== GLAVNE FUNKCIJE ====================
// Funkcija za Äitanje parametara iz URL-a
function getUrlParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

// Funkcija za uÄitavanje i pretragu podataka iz Google Sheets-a
async function loadCustomerData(customerId) {
    try {
        console.log('ğŸ” TraÅ¾im kupca sa ID:', customerId, 'u Sheets-u...');
        const response = await fetch(GOOGLE_SHEETS_CSV_URL);
        
        if (!response.ok) throw new Error(`Sheets nije dostupan (status: ${response.status})`);
        
        const csvText = await response.text();
        const rows = csvText.split('\n').map(row => row.split(','));

        // PreskoÄi zaglavlje (prvi red) i traÅ¾i kupca
        for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            // row[0] = customer_id, row[1] = customer_name, row[2] = audio_url
            if (row[0] && row[0].trim() === customerId) {
                console.log('âœ… Kupac pronaÄ‘en:', row[1]);
                return {
                    name: row[1] ? row[1].trim() : null,
                    audioUrl: row[2] ? row[2].trim() : null
                };
            }
        }
        console.warn('âš ï¸ Kupac nije pronaÄ‘en u tabeli.');
        return null; // Kupac nije pronaÄ‘en
        
    } catch (error) {
        console.error('âŒ GreÅ¡ka pri uÄitavanju iz Sheets-a:', error);
        return null;
    }
}

// ==================== PERSONALIZOVANE PRIÄŒE (opciono) ====================
const personalizedStories = {
    'Ana': 'Ana, tvoja poslastica je proÅ¡la kroz naÅ¡e najpaÅ¾ljivije ruke...',
    'Marko': 'Marko, torta koju drÅ¾iÅ¡ nastala je od ideje da slatko treba da bude avantura...',
    'Jelena': 'Jelena, tvoja torta je mali umeak savrÅ¡enstva...',
    'Nikola': 'Nikola, ovaj desert je priÄa o tradiciji i modernosti...',
};

const defaultStory = `Svaka torta iz Nana Sweets radnje nosi priÄu. PriÄu o paÅ¾ljivo odabranim sastojcima, o trenucima radosti koje stvara, i o ljubavi koju ulaÅ¾emo u svaki sloj. Dok drÅ¾ite ovu kutiju, drÅ¾ite deo naÅ¡e duÅ¡e. Sada vas pozivamo da Äujete i zvuk te priÄe...`;

// ==================== GLAVNI DEO - POKRETANJE KADA SE STRANICA UÄŒITA ====================
document.addEventListener('DOMContentLoaded', async function() {
    // 1. ProÄitaj parametar iz URL-a (sada koristimo 'kupac', ne 'ime' ili 'kod')
    const customerId = getUrlParameter('kupac'); // OÄekujemo npr. ?kupac=pera
    const welcomeText = document.getElementById('welcome-text');
    const storyText = document.getElementById('story-text');
    const audioSource = document.getElementById('audioSource');
    const audioPlayer = document.getElementById('audioPlayer');
    const shareButton = document.getElementById('shareButton');
    const audioStatus = document.getElementById('audio-status');
    
    let customerData = null;
    let customerNameToUse = null;
    let audioUrlToUse = null;
    
    // 2. Ako postoji ID kupca, pokuÅ¡aj da uÄitaÅ¡ podatke iz Sheets-a
    if (customerId) {
        customerData = await loadCustomerData(customerId);
    }
    
    // 3. POSTAVI PERSONALIZOVANE PODATKE
    if (customerData && customerData.name) {
        // Koristi podatke iz Sheets-a
        customerNameToUse = customerData.name;
        audioUrlToUse = customerData.audioUrl;
        
        welcomeText.innerHTML = `Zdravo <span class="customer-name">${customerNameToUse}</span>!<br>PosluÅ¡aj svoju liÄnu poruku ğŸ‚`;
        
        // Personalizuj priÄu ako postoji u naÅ¡em malom reÄniku
        if (personalizedStories[customerNameToUse]) {
            storyText.innerHTML = personalizedStories[customerNameToUse];
        }
        
        console.log('ğŸ¯ Koristim podatke iz Sheets-a.');
        
    } else {
        // Fallback: Koristi stari sistem sa 'ime' parametrom ako postoji (za kompatibilnost)
        const oldStyleName = getUrlParameter('ime');
        if (oldStyleName) {
            customerNameToUse = oldStyleName;
            welcomeText.innerHTML = `Zdravo <span class="customer-name">${customerNameToUse}</span>!<br>PosluÅ¡aj svoju liÄnu poruku ğŸ‚`;
            if (personalizedStories[customerNameToUse]) {
                storyText.innerHTML = personalizedStories[customerNameToUse];
            }
        }
        console.log('â„¹ï¸ Koristim podrazumevane podatke.');
    }
    
    // 4. POSTAVI AUDIO FAJL
    if (audioUrlToUse) {
        // Koristi link iz Sheets-a
        audioSource.src = audioUrlToUse;
    } else {
        // Fallback: VaÅ¡ default Dropbox audio (PROVERITE DA LI JE LINK RAWL=1!)
        audioSource.src = "https://www.dropbox.com/scl/fi/zl83tbmc3x4q3ki77e2w3/ElevenLabs_2025-12-25T03_07_47_Liam.mp3?raw=1"; // ğŸ‘ˆ Promenjeno u ?raw=1
    }
    
    audioPlayer.load(); // Ponovo uÄitaj plejer
    
    // 5. AÅ½URIRAJ SHARE LINK (Å¡alje customerId dalje)
    if (customerId) {
        shareButton.href = `https://nanasweets.github.io/nanasweetsaudio/share.html?kupac=${encodeURIComponent(customerId)}`;
    } else if (customerNameToUse) {
        // Fallback za stari sistem
        shareButton.href = `https://nanasweets.github.io/nanasweetsaudio/share.html?ime=${encodeURIComponent(customerNameToUse)}`;
    }
    
    // 6. PRAÄ†ENJE SLUÅ ANJA AUDIO (Ostaje isto)
    audioPlayer.addEventListener('play', function() {
        audioStatus.innerHTML = "ğŸµ SluÅ¡ate liÄnu poruku... Ova priÄa sada postaje zvuk!";
        audioStatus.style.color = "#ff1493";
        localStorage.setItem('nana_audio_listened', 'true');
        localStorage.setItem('nana_listen_time', new Date().toISOString());
        
        setTimeout(function() {
            shareButton.innerHTML = `<i class="fas fa-gift"></i> Sada osvoji svoj vauÄer! ğŸ`;
            shareButton.style.background = "linear-gradient(90deg,#4CAF50 0%,#45a049 100%)";
        }, 30000);
    });
    
    audioPlayer.addEventListener('ended', function() {
        audioStatus.innerHTML = "âœ… PriÄa je zavrÅ¡ena! Sada je vreme za vaÅ¡ vauÄer.";
        audioStatus.style.color = "#4CAF50";
        shareButton.innerHTML = `<i class="fas fa-gift"></i> Osvoji vauÄer ODMAH! ğŸ`;
        shareButton.style.background = "linear-gradient(90deg,#FF5722 0%,#FF9800 100%)";
        shareButton.style.animation = "pulse 1.5s infinite";
        
        const style = document.createElement('style');
        style.innerHTML = `@keyframes pulse { 
            0% { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255,87,34,0.4); }
            50% { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(255,87,34,0.6); }
            100% { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255,87,34,0.4); }
        }`;
        document.head.appendChild(style);
    });
    
    // 7. BROJAÄŒ POSETA (Ostaje isto)
    let visitCount = localStorage.getItem('nana_visit_count') || 0;
    visitCount = parseInt(visitCount) + 1;
    localStorage.setItem('nana_visit_count', visitCount);
    const visitCounterEl = document.getElementById('visit-counter');
    if (visitCounterEl) visitCounterEl.textContent = `Poseta: ${visitCount}`;
    
    // 8. PROVERA DA LI JE VEÄ† SLUÅ ANO (Ostaje isto)
    if (localStorage.getItem('nana_audio_listened') === 'true') {
        audioStatus.innerHTML = "ğŸ§ VeÄ‡ ste sluÅ¡ali poruku! Sada podelite iskustvo.";
        audioStatus.style.color = "#9C27B0";
        shareButton.innerHTML = `<i class="fas fa-share-alt"></i> Podeli i osvoji vauÄer ğŸ`;
    }
});
</script>
